<!DOCTYPE html>

<style>
.axis path,
.axis line {
  fill: none;
  stroke: #eee;
  shape-rendering: crispEdges;
}

.axis text {
  font-family: sans-serif;
  font-size: 11px;
}

.loading {
  font-family: sans-serif;
  font-size: 15px;
}

.circle {
  fill: #222;
}

.dot {
  stroke: #000;
}

.tooltip {
  position: absolute;
  width: 200px;
  height: 28px;
  pointer-events: none;
}
</style>
</style>


<div id="punchcard"></div>

<script src="http://d3js.org/d3.v2.min.js"></script>
<script>
var Data_url = 'https://dl.dropboxusercontent.com/u/22455492/fil.csv';


var margin = {top: 20, right: 20, bottom: 30, left: 40},
width = 960 - margin.left - margin.right,
height = 500 - margin.top - margin.bottom;

/*
* value accessor - returns the value to encode for a given data object.
* scale - maps value to a visual display encoding, such as a pixel position.
* map function - maps from data value to display value
* axis - sets up axis
*/

// setup x
var xValue = function(d) { return d["X"];}, // data -> value
xScale = d3.scale.linear().range([0, width]), // value -> display
xMap = function(d) { return xScale(xValue(d));}, // data -> display
xAxis = d3.svg.axis().scale(xScale).orient("bottom");

// setup y
var yValue = function(d) { return d["Y"];}, // data -> value
yScale = d3.scale.linear().range([height, 0]), // value -> display
yMap = function(d) { return yScale(yValue(d));}, // data -> display
yAxis = d3.svg.axis().scale(yScale).orient("left");

// setup fill color
var cValue = function(d) { return d["ImId"];},
color = d3.scale.category10();

// add the graph canvas to the body of the webpage
var svg = d3.select("#punchcard").append("svg")
.attr("width", width + margin.left + margin.right)
.attr("height", height + margin.top + margin.bottom)
.append("g")
.attr("transform", "translate(" + margin.left + "," + margin.top + ")");

var tooltip = d3.select("#punchcard").append("div")
    .attr("class", "tooltip")
    .style("opacity", 0);

//Define Scatter Plot region
//var svg = d3.select("#punchcard")
//        .append("svg")
//      .attr("width", w)
//        .attr("height", h);

//Everything gets build element by element.  Construct teh variables in javascript.
// Draw the axes as svg elements, Draw the Points as svg elements,

// load in the data
d3.csv(Data_url, function(data){

  xScale.domain([d3.min(data, xValue)-1, d3.max(data, xValue)+1]);
  yScale.domain([d3.min(data, yValue)-1, d3.max(data, yValue)+1]);

  // x-axis
  svg.append("g")
  .attr("class", "x axis")
  .attr("transform", "translate(0," + height + ")")
  .call(xAxis)
  .append("text")
  .attr("class", "label")
  .attr("x", width)
  .attr("y", -6)
  .style("text-anchor", "end")
  .text("PCA1");

  // y-axis
  svg.append("g")
  .attr("class", "y axis")
  .call(yAxis)
  .append("text")
  .attr("class", "label")
  .attr("transform", "rotate(-90)")
  .attr("y", 6)
  .attr("dy", ".71em")
  .style("text-anchor", "end")
  .text("PCA2");

  // draw dots
  svg.selectAll(".dot")
  .data(data)
  .enter().append("circle")
  .attr("class", "dot")
  .attr("r", 3.5)
  .attr("cx", xMap)
  .attr("cy", yMap)
  .style("fill", function(d) { return color(cValue(d));})
  .on("mouseover", function(d) {
          tooltip.transition()
               .duration(200)
               .style("opacity", .9);
          tooltip.html(d['ImId'])
               .style("left", (d3.event.pageX + 5) + "px")
               .style("top", (d3.event.pageY - 28) + "px");
      })
  .on("mouseout", function(d) {
      tooltip.transition()
           .duration(500)
           .style("opacity", 0);
  });

  var imxValue = function(d) { return data[0]["wX"];}; // data -> value
      imxScale = d3.scale.linear().range([0, d3.select("#im").style("width")]); // value -> display
      imxMap = function(d) { return imxScale(imxValue(d));}; // data -> display

  // setup y
  var imyValue = function(d) { return data[0]["wY"];}; // data -> value
      imyScale = d3.scale.linear().range([d3.select("#im").style("height"), 0]); // value -> display
      imyMap = function(d) { return imyScale(imyValue(d));}; // data -> display

  console.log( data[0] )


  var imwidth = d3.select("#im").style("width");

  var imscalex = d3.scale.linear()
                        .domain( [0, 1500] )
                        .range( [0, 1000] );
      imscaley = d3.scale.linear()
                            .domain( [0, 1500] )
                            .range( [0, 1000] );



  var g = d3.select("#im").append("svg")
              .attr("width", d3.select("#im").style("width") )
              .attr("height", d3.select("#im").style("height") )
              .append("g")

  var im = g.append("svg:image")
              .attr("xlink:href","https://farm4.staticflickr.com/3919/14466781737_a37c893a07_b.jpg")
              .attr("x",0)
              .attr("y",0)
              .attr("width",1000)
              .attr("height",1000)

  var bx = g.append("rect")
              .attr( "x", 10 )
              .attr( "y", 10 )
              .attr("width", imscalex(500) )
              .attr("height",imscaley(500) )
              .style("fill", "none")
              .style("stroke", "black")






})




</script>


<div id="im">
</div>
